
var browserSync = require("./index");
var connect = require("connect");
//var sass = require("gulp-ruby-sass");
var _    = require("lodash");
var http = require("http");
//var serveStatic  = require("serve-static");

console.time("init");

var files = ["test/fixtures/assets/*"];
var fs = require("fs");

var options = {
    server: {
        baseDir: ["./test/fixtures"],
        routes: {
            "/debug": "/usr/local/lib/node_modules/weinre/web"

        }
    },
//    tunnel: true,
//    proxy: "swoon.static/store-home.php",
    files: "test/fixtures/*.html",
    open: false
};

var cp     = require("/Users/shakyshane/Sites/browser-sync-modules/browser-sync-cp");
var client = require("/Users/shakyshane/Sites/browser-sync-modules/browser-sync-client");
client["plugin:name"] = "client:script";

browserSync.use(cp);
browserSync.use(client);

var instance = browserSync(options, function (err, bs) {

    setTimeout(function () {
        bs.setOption("codeSync", false);
        setTimeout(function () {
            bs.setOption("codeSync", true);
        }, 5000);
    }, 5000);
//
//    require("fs").writeFileSync("./opts-server.txt", JSON.stringify(bs.options, null, 4));
//    browserSync.exit();
//
//   next();
});

function next() {
    options.server = false;
    options.proxy  = "swoon.static/store-home.php";
    var instance = browserSync(options, function (err, bs) {
        require("fs").writeFileSync("./opts-proxy.txt", JSON.stringify(bs.options, null, 4));
        browserSync.exit();
    });

}
